<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <title>Ubuntu 安装 Sublime Text - 明无梦</title>
    <meta name="viewport" content="width=320, initial-scale=1">
    <meta name="author" content="mwum">
    <meta name="keywords" content="ubuntu,install,sublime-text,">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/syntax.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/animated_favicon1.gif" type="image/gif">
    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">
  </head>
  <body>
      <div class="header">
          <h1>
            <a href="/">明无梦</a>
            <span class="main"><a href="/">编程 自由 快乐 -+ 相信生命 相信奇迹</a></span>
          </h1>
          <hr />
          <ul>
            <li><a href="/">主页</a></li>
            <li><a href="/archive.html">文章</a></li>
            <li><a href="/categories.html">分类</a></li>
            <li><a href="/tags.html">标签</a></li>
            <li><a href="/rss.xml">RSS</a></li>
          </ul>
          <hr />
      </div>

      <div class="content">
        <h1 class="title"><a href="/ubuntu-install-sublime-text">Ubuntu 安装 Sublime Text</a></h1>
<ul class="post-tag">
  
    
      <li>2013-06-25 | 更新: 2013-07-21 | 标签: </li>
    

    
      <li><a href="/tags.html#ubuntu">ubuntu</a></li>
    
      <li><a href="/tags.html#install">install</a></li>
    
      <li><a href="/tags.html#sublime-text">sublime-text</a></li>
    
  
</ul>

<hr />

<h2 id="添加源方式安装">添加源方式安装</h2>
<pre><code>sudo add-apt-repository ppa:webupd8team/sublime-text-2
sudo apt-get update
sudo apt-get install sublime-text</code></pre>
<p>想要 Sublime Text 2 打开默认文本，可以修改关联列表</p>
<pre><code>sudo vim /usr/share/applications/defaults.list</code></pre>
<p>将所有的 gedit.desktop 替换成 sublime-text-2.desktop</p>
<h2 id="解决中文输入法问题">解决中文输入法问题</h2>
<p>我用的是 fcitx-sogoupinyin 输入法，无法输入中文，按如下办法可行</p>
<ol type="1">
<li><p>保存下述代码为 sublime-imfix.c 文件</p>
<pre class="sourceCode c"><code class="sourceCode c"><span class="co">/*</span>
<span class="co">sublime-imfix.c</span>
<span class="co">Use LD_PRELOAD to interpose some function to fix sublime input method support for linux.</span>
<span class="co">By Cjacker Huang &lt;jianzhong.huang at i-soft.com.cn&gt;</span>

<span class="co">gcc -shared -o libsublime-imfix.so sublime_imfix.c  `pkg-config --libs --cflags gtk+-2.0` -fPIC</span>
<span class="co">LD_PRELOAD=./libsublime-imfix.so sublime_text</span>
<span class="co">*/</span>
<span class="ot">#include &lt;gtk/gtk.h&gt;</span>
<span class="ot">#include &lt;gdk/gdkx.h&gt;</span>
<span class="kw">typedef</span> GdkSegment GdkRegionBox;

<span class="kw">struct</span> _GdkRegion
{
  <span class="dt">long</span> size;
  <span class="dt">long</span> numRects;
  GdkRegionBox *rects;
  GdkRegionBox extents;
};

GtkIMContext *local_context;

<span class="dt">void</span>
gdk_region_get_clipbox (<span class="dt">const</span> GdkRegion *region,
            GdkRectangle    *rectangle)
{
  g_return_if_fail (region != NULL);
  g_return_if_fail (rectangle != NULL);

  rectangle-&gt;x = region-&gt;extents.x1;
  rectangle-&gt;y = region-&gt;extents.y1;
  rectangle-&gt;width = region-&gt;extents.x2 - region-&gt;extents.x1;
  rectangle-&gt;height = region-&gt;extents.y2 - region-&gt;extents.y1;
  GdkRectangle rect;
  rect.x = rectangle-&gt;x;
  rect.y = rectangle-&gt;y;
  rect.width = <span class="dv">0</span>;
  rect.height = rectangle-&gt;height;
  <span class="co">//The caret width is 2;</span>
  <span class="co">//Maybe sometimes we will make a mistake, but for most of the time, it should be the caret.</span>
  <span class="kw">if</span>(rectangle-&gt;width == <span class="dv">2</span> &amp;&amp; GTK_IS_IM_CONTEXT(local_context)) {
        gtk_im_context_set_cursor_location(local_context, rectangle);
  }
}

<span class="co">//this is needed, for example, if you input something in file dialog and return back the edit area</span>
<span class="co">//context will lost, so here we set it again.</span>

<span class="dt">static</span> GdkFilterReturn event_filter (GdkXEvent *xevent, GdkEvent *event, gpointer im_context)
{
    XEvent *xev = (XEvent *)xevent;
    <span class="kw">if</span>(xev-&gt;type == KeyRelease &amp;&amp; GTK_IS_IM_CONTEXT(im_context)) {
       GdkWindow * win = g_object_get_data(G_OBJECT(im_context),<span class="st">&quot;window&quot;</span>);
       <span class="kw">if</span>(GDK_IS_WINDOW(win))
         gtk_im_context_set_client_window(im_context, win);
    }
    <span class="kw">return</span> GDK_FILTER_CONTINUE;
}

<span class="dt">void</span> gtk_im_context_set_client_window (GtkIMContext *context,
          GdkWindow    *window)
{
  GtkIMContextClass *klass;
  g_return_if_fail (GTK_IS_IM_CONTEXT (context));
  klass = GTK_IM_CONTEXT_GET_CLASS (context);
  <span class="kw">if</span> (klass-&gt;set_client_window)
    klass-&gt;set_client_window (context, window);

  <span class="kw">if</span>(!GDK_IS_WINDOW (window))
    <span class="kw">return</span>;
  g_object_set_data(G_OBJECT(context),<span class="st">&quot;window&quot;</span>,window);
  <span class="dt">int</span> width = gdk_window_get_width(window);
  <span class="dt">int</span> height = gdk_window_get_height(window);
  <span class="kw">if</span>(width != <span class="dv">0</span> &amp;&amp; height !=<span class="dv">0</span>) {
    gtk_im_context_focus_in(context);
    local_context = context;
  }
  gdk_window_add_filter (window, event_filter, context);
}</code></pre></li>
<li><p>安装 C/C++ 的编译环境和 gtk libgtk2.0-dev</p>
<pre><code>sudo apt-get install build-essential
sudo apt-get install libgtk2.0-dev</code></pre></li>
<li><p>编译共享内库</p>
<pre><code>gcc -shared -o libsublime-imfix.so sublime-imfix.c  `pkg-config --libs --cflags gtk+-2.0` -fPIC</code></pre></li>
<li><p>启动 Sublime Text 2</p>
<pre><code>LD_PRELOAD=./libsublime-imfix.so sublime-text</code></pre></li>
</ol>
<p>但是这样的话，我们每次都要在终端里面使用命令启动 sublime text 2，这样很不方便， 接下来我们还要通过修改 sublime-text-2.desktop 达到点击图标启动</p>
<pre><code>sudo mv libsublime-imfix.so /usr/lib
sudo vim /usr/share/applications/sublime-text-2.desktop</code></pre>
<p>将</p>
<pre><code>Exec=/usr/bin/subl %F</code></pre>
<p>修改为</p>
<pre><code>Exec=bash -c &#39;LD_PRELOAD=/usr/lib/libsublime-imfix.so /usr/bin/subl %F&#39;</code></pre>
<p>将</p>
<pre><code>Exec=/usr/bin/subl --command new_file</code></pre>
<p>修改为</p>
<pre><code>Exec=bash -c &#39;LD_PRELOAD=/usr/lib/libsublime-imfix.so /usr/bin/subl&#39; --command new_file</code></pre>
<p>好了，接下来你在 dash 中点击打开 sublime-text-2 吧，开始你的代码之旅吧</p>
<hr />
<p>参考：<br /><a href="http://my.oschina.net/wugaoxing/blog/121281">http://my.oschina.net/wugaoxing/blog/121281</a></p>


<br />
<hr />

<div class="next-prev post">
  
  <span>上一篇：</span><a href="/ubuntu-install-lamp" title="Ubuntu 搭建 LAMP(Linux+Apache+MySQL+Php) 环境">Ubuntu 搭建 LAMP(Linux+Apache+MySQL+Php) 环境</a><br />
  
  
  <span>下一篇：</span><a href="/install-ubuntu-after" title="安装 Ubuntu 后要做的一些事">安装 Ubuntu 后要做的一些事</a>
  
</div>

<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mwum'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </div>

      <div class="footer">
        <hr />
        <span>本站采用 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a> 进行许可</span><br />
        <span>&copy;2013-2013 <a href="http://www.dreamxu.com/">明无梦 - dreamxu.com</a> | </span>
        <span>Powered by <a href="http://jekyllrb.com/">jekyll</a> | </span>
        <span>Hosted by <a href="https://github.com/">github</a> | </span>
        <span>Designed by <a href="http://www.dreamxu.com/">明无梦</a></span>
      </div>

      

      <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-39279084-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  </body>
</html>
